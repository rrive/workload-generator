# Operation Transition Graph Generator Tool for REST API Testing
This tool generates a Markov chain based on application logs, modeling transitions of operations in a REST API. A graph is created from the logs that represents the actual behavior of users interacting with the application, enabling realistic test case generation. 

This tool was created to be used in the REST API testing tool [JepREST](https://github.com/preguica/JepREST) to request a new operation everytime a client recieves an answer from the SUT.

------------
## Features
The tool performs the following tasks:

1. **Graph Generation**:
	- Creates an empty graph based on the operations defined in the API.
	- Each operation is represented by a unique vertex.

1. **Log Parsing**:
	- Reads a log file provided by the user, extracting transitions between operations.
	- The logs must follow the specified format and contain information such as the client's IP address, HTTP method, path, status code, etc.
	- Transitions between operations are interpreted based on the sequence of requests and responses.

1. **Graph Population**:
	- The tool populates the graph with transitions extracted from the logs, creating edges between consecutive operations.
	- Each edge is assigned a conditional weight, representing the transition probability between operations based on the status code of the previous operation.

1. **Probability Calculation**:
	- Calculates the probability of each operation being the first to execute in a new session.
	- Determines the transition probability between operations, considering previous responses and their status codes.

## Tool Operations

The tool provides two main operations for interaction:

- **First Op**: Returns the identifier of the operation to be executed first in a new session.
- **Next Op**: Returns the identifier of the operation to be executed after a response, depending on the received status code.
If the next operation is not valid, it indicates the session has ended.


------------
## Example

### Operation Transitions Graph

<img src="https://github.com/rrive/workload-generator/blob/master/OTG%20Example.png" width=50% height=50%>

The graph generated by the tool models the flow of a REST application with operations A, B, and C. It determines the next operation based on the response code of the previous one. For example, a 200 code for A might lead to B or C with different probabilities, while a 404 will repeat A. The session ends when C is executed.


### Log Format

The log file should contain the information in the presented order:

1. Request identifier executed by the client.
1. Client's IP address that made the request.
1. Date when the request/response was made.
1. HTTP method used in the request.
1. Request path.
1. HTTP status code of the response (only if the event represents a response).
1. List of path parameters in the request.
1. List of query parameters in the request.
1. Headers present in the request/response.
1. Body of the request/response.

#### Example

```css
[535032503:192.168.0.2] Mon Sep 02 11:03:08 UTC 2024 - GET users/john 200 params={{userId=[john]}} query={pwd=pswd} headers={Content-Type=[application/json]} body={"userId":"john","pwd":"pwd","email":"johndoe@email.com","displayName":"John Doe"}
```

------------
## How to Run

Running the following command creates the graph and stores it in the JepREST directory so the clients can access the graph and ask for new operations.

```bash
./install-workload-graph-in-JepREST.sh <path/to/JepREST> <projectName> <path/to/logFile>
```

### Example

If:
- JepREST directory is located in ```/home/user```
- The application beign tested is called ```petstore``` 
- The log file location is ```/home/user/petstore/logs/access.log```

Then the command is:
```bash
./install-workload-graph-in-JepREST.sh home/user/JepREST petstore /home/user/petstore/logs/access.log
```







